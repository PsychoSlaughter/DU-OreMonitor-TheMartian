{"slots":{"0":{"name":"screen1","type":{"events":[],"methods":[]}},"1":{"name":"screen2","type":{"events":[],"methods":[]}},"2":{"name":"screen3","type":{"events":[],"methods":[]}},"3":{"name":"screen4","type":{"events":[],"methods":[]}},"4":{"name":"screen5","type":{"events":[],"methods":[]}},"5":{"name":"emitter","type":{"events":[],"methods":[]}},"6":{"name":"receiver","type":{"events":[],"methods":[]}},"7":{"name":"core","type":{"events":[],"methods":[]}},"8":{"name":"screen","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"","filter":{"args":[],"signature":"","slotKey":"5"},"key":3},{"code":"-- unit.start of the main ore monitor board\n\n--screen.setCenteredText(\"hello\")\n\n\noresAllMax = {}\nlocal nitronMax = 12800 --export: nitronMax\noresAllMax.nitron = nitronMax\nlocal scrapMax = 12800 --export: scrapMax\noresAllMax.scrap = scrapMax\nlocal quartzMax = 57600 --export: quartzMax\noresAllMax.quartz = quartzMax\nlocal hematiteMax = 57600 --export: hematiteMax\noresAllMax.hematite = hematiteMax\nlocal coalMax = 57600 --export: coalMax\noresAllMax.coal = coalMax\nlocal bauxiteMax = 57600 --export: bauxiteMax\noresAllMax.bauxite = bauxiteMax\nlocal natronMax = 29440 --export: natronMax\noresAllMax.natron = natronMax\nlocal malachiteMax = 12800 --export: malachiteMax\noresAllMax.malachite = malachiteMax\nlocal limestoneMax = 38400 --export: limestoneMax\noresAllMax.limestone = limestoneMax\nlocal chromiteMax = 28160 --export: chromiteMax\noresAllMax.chromite = chromiteMax\nlocal garnieriteMax = 12800 --export: garnieriteMax\noresAllMax.garnierite = garnieriteMax\nlocal pyriteMax = 12800 --export: pyriteMax\noresAllMax.pyrite = pyriteMax\nlocal acanthiteMax = 12800 --export: acanthiteMax\noresAllMax.acanthite = acanthiteMax\nlocal petaliteMax = 12800 --export: petaliteMax\noresAllMax.petalite = petaliteMax\nlocal cryoliteMax = 12800 --export: cryoliteMax\noresAllMax.cryolite = cryoliteMax\nlocal cobaltiteMax = 12800 --export: cobaltiteMax\noresAllMax.cobaltite = cobaltiteMax\nlocal goldMax = 12800 --export: goldMax\noresAllMax.gold = goldMax\nlocal kolbeckiteMax = 12800 --export: kolbeckiteMax\noresAllMax.kolbeckite = kolbeckiteMax\nlocal columbiteMax = 12800 --export: columbiteMax\noresAllMax.columbite = columbiteMax\nlocal rhodoniteMax = 12800 --export: rhodoniteMax\noresAllMax.rhodonite = rhodoniteMax\nlocal illmeniteMax = 12800 --export: illmeniteMax\noresAllMax.illmenite = illmeniteMax\nlocal vanadiniteMax = 12800 --export: vanadiniteMax\noresAllMax.vanadinite = vanadiniteMax\n\n\njsonstrOres = json.encode(oresAllMax)\n--emitter.send(\"oresAllMax\", jsonstrOres)\n\n\nemitter.send(\"oresAllMax\",jsonstrOres:gsub(\"\\\"\", \"@@@\"))\n\n\n\n\n-- Givens\nlocal elementData = {}\nelementData.nitron = {}\nelementData.nitron.type = 'FUEL'\nelementData.nitron.density = 4\nelementData.scrap = {}\nelementData.scrap.type = 'ETC'\nelementData.scrap.density = 8.96\nelementData.quartz = {}\nelementData.quartz.type = 'TIER 1'\nelementData.quartz.density = 2.64\nelementData.hematite = {}\nelementData.hematite.type = 'TIER 1'\nelementData.hematite.density = 5.04\nelementData.coal = {}\nelementData.coal.type = 'TIER 1'\nelementData.coal.density = 1.35\nelementData.bauxite = {}\nelementData.bauxite.type = 'TIER 1'\nelementData.bauxite.density = 1.28\nelementData.natron = {}\nelementData.natron.type = 'TIER 2'\nelementData.natron.density = 1.55\nelementData.malachite = {}\nelementData.malachite.type = 'TIER 2'\nelementData.malachite.density = 4\nelementData.limestone = {}\nelementData.limestone.type = 'TIER 2'\nelementData.limestone.density = 2.71\nelementData.chromite = {}\nelementData.chromite.type = 'TIER 2'\nelementData.chromite.density = 4.54\nelementData.garnierite = {}\nelementData.garnierite.type = 'TIER 3'\nelementData.garnierite.density = 2.6\nelementData.pyrite = {}\nelementData.pyrite.type = 'TIER 3'\nelementData.pyrite.density = 5.01\nelementData.acanthite = {}\nelementData.acanthite.type = 'TIER 3'\nelementData.acanthite.density = 7.2\nelementData.petalite = {}\nelementData.petalite.type = 'TIER 3'\nelementData.petalite.density = 2.41\nelementData.cryolite = {}\nelementData.cryolite.type = 'TIER 4'\nelementData.cryolite.density = 2.95\nelementData.cobaltite = {}\nelementData.cobaltite.type = 'TIER 4'\nelementData.cobaltite.density = 6.33\nelementData.gold = {}\nelementData.gold.type = 'TIER 4'\nelementData.gold.density = 19.3\nelementData.kolbeckite = {}\nelementData.kolbeckite.type = 'TIER 4'\nelementData.kolbeckite.density = 2.37\nelementData.columbite = {}\nelementData.columbite.type = 'TIER 5'\nelementData.columbite.density = 5.38\nelementData.rhodonite = {}\nelementData.rhodonite.type = 'TIER 5'\nelementData.rhodonite.density = 3.76\nelementData.illmenite = {}\nelementData.illmenite.type = 'TIER 5'\nelementData.illmenite.density = 4.55\nelementData.vanadinite = {}\nelementData.vanadinite.type = 'TIER 5'\nelementData.vanadinite.density = 6.95\n\n\n\n\n\n\n--local oreTable = {}\nlocal oreTableTier1 = {{\"BAUXITE\"}, {\"COAL\"}, {\"HEMATITE\"}, {\"QUARTZ\"}}\nlocal oreTableTier2 = {{\"CHROMITE\"}, {\"LIMESTONE\"}, {\"MALACHITE\"}, {\"NATRON\"}}\nlocal oreTableTier3 = {{\"ACANTHITE\"}, {\"GARNIERITE\"}, {\"PETALITE\"}, {\"PYRITE\"}}\nlocal oreTableTier4 = {{\"COBALTITE\"}, {\"CRYOLITE\"}, {\"GOLD\"}, {\"KOLBECKITE\"}}\nlocal oreTableTier5 = {{\"COLUMBITE\"}, {\"ILLMENITE\"}, {\"RHODONITE\"}, {\"VANADINITE\"}}\n\nlocal oreTableAll = {{\"BAUXITE\", \"CHROMITE\", \"ACANTHITE\", \"COBALTITE\", \"COLUMBITE\"}, {\"COAL\", \"LIMESTONE\", \"GARNIERITE\", \"CRYOLITE\", \"ILLMENITE\"}, {\"HEMATITE\", \"MALACHITE\", \"PETALITE\", \"GOLD\", \"RHODONITE\"}, {\"QUARTZ\", \"NATRON\", \"PYRITE\", \"KOLBECKITE\", \"VANADINITE\"}}\n\n--html\nlocal htmlStyle = [[\n    <style>.box{background-color: black; width: 99%; height: 98%; margin: 0.5em auto; border-style: solid; border-color: #0cfffd; border-width: medium;}table{border-collapse: collapse; width: 100%; height: 100%;}tr{border-style: none; border-color: #0cfffd; border-width: medium; width: 100%;}tr:last-child{border-style: none;}th{border-style: none solid solid none; border-color: #0cfffd; border-width: medium; padding-left: 1.2em; background-color: #09212b; text-align: left; font-size: 1.5em; font-weight: bold; height: 3em;}th span{font-size: 0.8em; color: #4ae25b;}th:last-child{border-style: none none solid none;}td{border-style: none solid none none; border-color: #0cfffd; border-width: medium; justify-content: center; width: 20%;}td:last-child{border-style: none;}.oreBox{height: 100%; width: 90%; display: table; margin: 0px auto; border-style: none none solid none; border-color: #fff; border-width: thin; text-align: center;}.lastRow{border-style:none;}.bottom{border-style: none;}.oreTitle{font-size: 1.8em; line-height: 1.8em;}.oreInfo{width: 70%; margin: auto; font-size: 2.5em; text-align: center; outline: thin solid white;}.oreInfo span{font-size: 0.5em; color: #0cfffd;}.oreGauge{font-size: 1.5em; line-height: 1.5em;}.progress-bar{height: 3em; width: 80%; vertical-align: bottom; border-style: solid none; border-color: #292929; border-width: 0.5em; background-color: rgba(7, 34, 43, 0.73); background-color: #195959; position: relative; margin: 1em auto 0em;}.progress-bar span{display: inline-block; height: 100%; position: absolute; left: 0; top: 0; background-color: #0cfffd;}\n]]\n\nlocal htmlSingleStyle = [[\n    .oreBox{width: 100%;}.oreTitle{display: table-cell; width: 40%; vertical-align: middle; font-size: 2.8em;}.oreInfo{outline: none; font-size: 2.8em; width: 30%; display: table-cell; vertical-align: middle;}.infoBox{outline: thin solid white; width: 50%; height: 2.5em; line-height: 2.5em; margin: auto;}.oreGauge{vertical-align: middle; font-size: 2.8em; display: table-cell;}.progress-bar{width: 60%; font-size: 0.5em;}\n]]   \n        \nlocal htmlStart =  [[\n    </style>\n    <div class=\"box\">\n        <table>\n            <tr>\n]]\n\n\nlocal htmlEnd = [[\n        </table>\n    </div>\n]]\n\n\nfunction getAllContainerHubs()\n    hubs = {}\n    elementIds = core.getElementIdList()\n    for _, id in ipairs(elementIds) do\n        elType = core.getElementTypeById(id)\n        if elType == \"Container Hub\" then\n        name = core.getElementNameById(id)\n        hubs[name] = id\n        end\n    end\n    return hubs\nend\n\n\n\n-- start the action\ngetAllContainerHubs()\n\n\nlocal tableRow = \"\"\nlocal htmlTable = \"\"\n\nlocal oreVolumes = {}\n\n\nfunction screenUpdate(tier)\n   \n\t\n    local tableHeader = \"\"\n    local tableStyle = \"\"\n    if tier == 1 then\n        tableHeader = [[<th><span>ORE</span></br>TIER 1</th></tr>]]\n        oreTable = oreTableTier1\n        tableStyle = \"single\"\n        screen1.activate()\n    elseif tier == 2 then\n        tableHeader = [[<th><span>ORE</span></br>TIER 2</th></tr>]]\n        oreTable = oreTableTier2\n        tableStyle = \"single\"\n        screen2.activate()\n    elseif tier == 3 then\n        tableHeader = [[<th><span>ORE</span></br>TIER 3</th></tr>]]\n        oreTable = oreTableTier3\n        tableStyle = \"single\"\n        screen3.activate()\n    elseif tier == 4 then\n        tableHeader = [[<th><span>ORE</span></br>TIER 4</th></tr>]]\n        oreTable = oreTableTier4\n        tableStyle = \"single\"\n        screen4.activate()\n    elseif tier == 5 then\n        tableHeader = [[<th><span>ORE</span></br>TIER 5</th></tr>]]\n        oreTable = oreTableTier5\n        tableStyle = \"single\"\n        screen5.activate()\n    else \n        tableHeader = [[<th><span>ORE</span></br>TIER 1</th>\n        <th><span>ORE</span></br>TIER 2</th>\n        <th><span>ORE</span></br>TIER 3</th>\n        <th><span>ORE</span></br>TIER 4</th>\n        <th><span>ORE</span></br>TIER 5</th></tr>]]\n        oreTable = oreTableAll\n         screen.activate()\n    end\n\n    \n    local htmlTable = \"\"\n    for i in ipairs(oreTable) do\n        \n\n        local tableRow = \"\"\n        for row,ore in ipairs(oreTable[i]) do\n\n            oreName = ore:lower()\n            oreDensity = elementData[oreName].density\n\n            local ore_id = hubs[ore]\n            if ore_id == nil then\n                system.print(ore..\" Hub was not found!\")\n            else\n                oreVol = math.floor((core.getElementMassById(ore_id)/oreDensity)/1000 + 0.5)\n                oreVolumes[oreName] = oreVol\n\n                contMax = math.floor(oresAllMax[oreName] / 100)\n                orePercent = math.floor(100 * oreVol / contMax + 0.5) \n            end\n\n            local divClass = [[oreBox]]\n            if i == #oreTable then\n            divClass = [[oreBox lastRow]]\n            end\n\n            local tableCell = [[\n                <td>\n                <div class=\"]]..divClass..[[\">\n                    <div class=\"oreTitle\">\n                        ]]..ore..[[\n                    </div>\n                    <div class=\"oreInfo\">\n                        ]]..oreVol..[[\n                        <span>/]]..contMax..[[ kL</span>\n                    </div>\n                    <div class=\"progress-bar\">\n                        <span style=\"width: ]]..orePercent..[[%;background-color: #0CFFFD;\"></span>\n                    </div>\n                    <div class=\"oreGauge\">\n                    ]]..orePercent..[[%\n                    </div>\n                </div>\n                </td>\n            ]]\n\n\n            local singleTableCell = [[\n                <td>\n                <div class=\"]]..divClass..[[\">\n                    <div class=\"oreTitle\">\n                        ]]..ore..[[\n                    </div>\n                    <div class=\"oreInfo\">\n                        <div class=\"infoBox\">\n                            ]]..oreVol..[[\n                            <span>/]]..contMax..[[ kL</span>\n                        </div>\n                    </div>\n                    <div class=\"oreGauge\">\n                        <div class=\"progress-bar\">\n                            <span style=\"width: ]]..orePercent..[[%;background-color: #0CFFFD;\"></span>\n                        </div>\n            \n                        ]]..orePercent..[[%\n                    </div>\n                </div>\n            </td>\n            ]]\n\n\n            if tableStyle == \"single\" then\n                tableRow = tableRow .. singleTableCell\n            else    \n                tableRow = tableRow .. tableCell\n            end\n        end\n\n        htmlTable = htmlTable .. \"<tr>\" .. tableRow .. \"</tr>\"\n    end\n\n    local fullHTML = \"\"\n    if tableStyle == \"single\" then\n        fullHTML = htmlStyle .. htmlSingleStyle .. htmlStart .. tableHeader .. htmlTable .. htmlEnd\n    else\n        fullHTML = htmlStyle .. htmlStart .. tableHeader .. htmlTable .. htmlEnd\n    end\n\n    if tier == 1 then\n        screen1.setHTML(fullHTML)\n    elseif tier == 2 then\n        screen2.setHTML(fullHTML)\n    elseif tier == 3 then\n        screen3.setHTML(fullHTML)\n    elseif tier == 4 then\n        screen4.setHTML(fullHTML)\n    elseif tier == 5 then\n        screen5.setHTML(fullHTML)\n    else \n        screen.setHTML(fullHTML)\n    end\n\n    local jsonstr = json.encode(oreVolumes)\n\n    emitter.send(\"oresAllVol\", jsonstr)\nend\n\n\n\nunit.setTimer(\"statusUpdate\", 1)","filter":{"args":[],"signature":"start()","slotKey":"-1"},"key":"0"},{"code":"\nscreenUpdate()\nscreenUpdate(1)\nscreenUpdate(2)\nscreenUpdate(3)\nscreenUpdate(4)\nscreenUpdate(5)\n\n--emitter.send(\"oresAllMax\", jsonstrOres)\nemitter.send(\"oresAllMax\",jsonstrOres:gsub(\"\\\"\", \"@@@\"))\n--system.print(jsonstrOres)\n\n\ncollectgarbage(\"collect\")\n\n","filter":{"args":[{"value":"statusUpdate"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"1"}],"methods":[],"events":[]}
